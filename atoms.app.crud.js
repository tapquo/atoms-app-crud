/**
 * atoms.app.crud - 
 * @version v1.0.0
 * @link    http://tapquo.com
 * @author   ()
 * @license 
 */
(function(){"use strict";var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Atoms.Organism.Crud=function(_super){function Crud(data){Crud.__super__.constructor.apply(this,arguments),null!=data&&(null!=data.title&&this.header.title.refresh({value:data.title}),null!=data.entity&&(this.entityType=data.entity,this.columns=this._parseArrayToColumnsObj(data.entity.attributes)),null!=data.columns&&(this.columns=data.columns),null!=data.required&&(this.required=data.required),null!=this.columns&&this._createFields(this.columns,null!=this.required))}return __extends(Crud,_super),Crud.events=["create","update","delete"],Crud["default"]={id:"crud",children:[{"Organism.Header":{id:"header",children:[{"Atom.Heading":{id:"title",value:"CRUD"}},{"Molecule.Navigation":{style:"right",children:[{"Atom.Button":{icon:"close",callbacks:["onClose"]}}]}}]},"Organism.Section":{id:"section",children:[{"Molecule.Form":{id:"form"}}]},"Organism.Footer":{id:"footer",children:[{"Molecule.Navigation":{id:"nav",children:[{"Atom.Button":{id:"delete",text:"Delete",callbacks:["onDestroy"],style:"left"}},{"Atom.Button":{id:"save",text:"Save",callbacks:["onSave"],style:"right"}}]}}]}}]},Crud["extends"]=!0,Crud.prototype._parseArrayToColumnsObj=function(array){var columns,field,_i,_len;for(columns={},_i=0,_len=array.length;_len>_i;_i++)field=array[_i],columns[field]="text";return columns},Crud.prototype._createFields=function(columns,required){var field,properties,_results;this.section.form.destroyChildren(),_results=[];for(field in columns)properties={id:field,name:field,type:"text",placeholder:field,required:__indexOf.call(null!=required,field)>=0?!0:void 0},_results.push(this.section.form.appendChild("Atom.Input",properties));return _results},Crud.prototype.onClose=function(){return this.hide()},Crud.prototype.onSave=function(){var child,requiredPass,_i,_len,_ref;for(requiredPass=!0,_ref=this.section.form.children,_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],child.attributes.required&&!child.value()?(child.el.addClass("error"),requiredPass=!1):child.el.removeClass("error");return requiredPass?(null!=this.entitySelected?this.update(this.entitySelected):this.create(this.section.form.value()),this.hide()):void 0},Crud.prototype.onDestroy=function(){return this.destroy(this.entitySelected),this.hide()},Crud.prototype.show=function(info){var columns,field,_results;if(Crud.__super__.show.apply(this,arguments),this.section.form.clean(),this.footer.nav["delete"].el.hide(),null==info)return this.entitySelected=null;if(null!=info.title&&this.header.title.refresh({value:info.title}),null!=info.entity&&(this.entitySelected=info.entity,this.footer.nav["delete"].el.show()),columns=null!=info.columns?info.columns:null!=info.entity?this._parseArrayToColumnsObj(__.Entity[info.entity.className].attributes):this.columns,this._createFields(columns,null!=info.required?info.required:this.required),null!=columns){_results=[];for(field in columns)_results.push(this.section.form[""+field].value(info.entity[""+field]));return _results}},Crud.prototype.create=function(values){var entity;return entity=this.entityType.create(values),this.trigger("create",entity)},Crud.prototype.update=function(entity){return entity.updateAttributes(this.section.form.value()),this.trigger("update",entity)},Crud.prototype.destroy=function(entity){return entity.destroy(),this.trigger("destroy",entity)},Crud}(Atoms.Organism.Dialog)}).call(this);